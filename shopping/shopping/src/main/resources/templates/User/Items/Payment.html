<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">

<th:block th:replace="~{../static/css/home/top.css}"></th:block>
<th:block th:replace="~{../static/css/User/Basket.css}"></th:block>
<th:block th:replace="~{../static/css/home/bottom.css}"></th:block>

<body>
<th:block th:replace="~{../static/inc/top.html}"></th:block>
<section>
    <form action="/User/PayResult" method="post">
    <table style="text-align:center;"> <!-- 장바구니에서 결제로 넘긴 물품 목록 -->
        <tr>
            <td colspan="4" style="text-decoration:underline;">
                <h2>Order Info</h2>
            </td>
        </tr>

        <tr>
            <td style="width:100px;"><b>구분</b></td>
            <td style="width:200px;"><b>제품명</b></td>
            <td style="width:100px;"><b>수량</b></td>
            <td style="width:100px;"><b>가격</b></td>
        </tr>

        <tr th:each="list, listStat : ${list}">
           <td>
               <img th:src="@{/tools/download(image = ${list.thumbnail})}" style="border:1px solid; width:50px; height:50px;">
               <input type="hidden" name="item_idx" th:value="${list.Item_idx}">
               <input type="hidden" name="basket_idx" th:value="${list.Basket_idx}">
           </td>
           <td><span>[[${list.ItemName}]]</span></td>
           <td>
               <span>[[${list.quantity}]]</span> 개
               <input type="hidden" name="item_quantity" th:value="${list.quantity}">
           </td>
           <td>
               <span class="price">[[${list.quantity} * ${list.price}]]</span>원
               <input type="hidden" name="total_pay" th:value="${list.quantity} * ${list.price}">
           </td>
        </tr>

        <tr>
            <td colspan="4" style="text-align:right;">
                <b>총 결제 금액</b>: <span id="total"></span> 원
                <input type="hidden" id="total_pay" value="">
            </td>
        </tr>
    </table>
    <hr style="width:700px; height:1px; background-color:slategray;">
    <table> <!-- 결제 -->
        <tr>
            <td colspan="2" style="text-align:center; text-decoration:underline;">
                <h2>Payment Info</h2>
            </td>
        </tr>

        <tr>
            <td><b>결제수단</b></td>
            <td>
                <input type="radio" name="pay" value="account" onclick="payment_way(this.value)">계좌이체
                <input type="radio" name="pay" value="card" onclick="payment_way(this.value)">카드결제
                <input type="radio" name="pay" value="drink_pay" onclick="payment_way(this.value)">Drink Pay
                <br>
            </td>
        </tr>

        <tr>
            <td colspan="2" style="text-align:center;">
                <br>
                <div id="account_div" style="display:none;"> <!-- 계좌이체  -->
                    <select onchange="random_account(this.value)" style="text-align:center; border-top:0px; border-left:0px; border-right:0px;">
                        <option value="none">선택</option>
                        <option value="NH_BANK">NH 농협</option>
                        <option value="DGB_BANK">대구은행</option>
                        <option value="IBK_BANK">기업은행</option>
                        <option value="SHINHAN_BANK">신한은행</option>
                    </select>
                    &emsp;
                    <input type="text" id="auto_account" readonly style="text-align:center; border-top:0px; border-left:0px; border-right:0px;">
                </div>

                <div id="card_div" style="display:none;"> <!-- 카드결제 -->
                    <div>
                        <span><b>카드사</b></span>
                        <select style="text-align:center; width:200px;">
                            <option>선택</option>
                            <option>삼성카드</option>
                            <option>KB국민카드</option>
                            <option>신한카드</option>
                            <option>현대카드</option>
                            <option>BC카드</option>
                        </select>
                    </div>
                    <div>
                        <span><b>카드번호</b></span>
                        <input type="number" min="1111" max="9999" style="width:50px;">
                        <input type="number" min="1111" max="9999" style="width:50px;">
                        <input type="number" min="1111" max="9999" style="width:50px;">
                        <input type="number" min="1111" max="9999" style="width:50px;">
                    </div>
                    <div>
                        <span><b>CVC / CVV 번호</b></span>
                        <input type="number" min="100" max="999" placeholder="카드 뒷면 숫자 3자리" style="width:150px;">
                    </div>
                </div>

                <div id="drink_pay_div" style="text-align:center; display:none;">
                    <div>
                        <b>현재 잔액: </b> <span id="pay_cash" th:text="${user.cash}"></span>원 &emsp; +<b>충전</b>
                    </div><br>
                    <div>
                        <b>결제 금액: </b> <span id="pay_price">1200</span>원
                    </div><br>
                    <div>
                        <b>결제 후 잔액: </b> <span id="pay_result"></span>원
                    </div>
                </div>
                <br>
            </td>
        </tr>
    </table>
    <hr style="width:700px; height:1px; background-color:slategray;">
    <table>
        <tr>
            <td colspan="2" style="text-align:center; text-decoration:underline;"><h2>Delivery Info</h2></td>
        </tr>

        <tr>
            <td colspan="2" style="text-align:center;">
                <input type="radio" name="getter_set" value="">내 주소입력
                &emsp;&emsp;
                <input type="radio" name="getter_set" value="">직접입력
                <br><br>
            </td>
        </tr>

        <tr>
            <td><b>받는분</b></td>
            <td><input type="text" name="getter"></td>
        </tr>

        <tr>
            <td><b>연락처</b></td>
            <td><input type="text" name="hp" placeholder="-없이 숫자만 입력"></td>
        </tr>

        <tr>
            <td><b>주소</b></td>
            <td>
                <input type="text" name="add1" id="add1" placeholder="우편번호">
                <input type="button" onclick="address_api()" value="우편번호 찾기"><br>
                <input type="text" name="add2" id="add2" placeholder="주소">
                <input type="text" name="add3" id="add3" placeholder="참고항목">
            </td>
        </tr>

        <tr>
            <td><b>배송 시<br>요청 사항</b></td>
            <td>
                <select id="order_request" onchange="request_set(this.value)">
                    <option value="none">배송 메모를 선택해주세요.</option>
                    <option value="부재 시 연락바랍니다.">부재 시 연락바랍니다.</option>
                    <option value="부재 시 경비실에 맡겨주세요.">부재 시 경비실에 맡겨주세요.</option>
                    <option value="배송 전 연락주세요.">배송 전 연락주세요.</option>
                    <option value="택배보관함에 보관해주세요.">택배보관함에 보관해주세요.</option>
                    <option value="부재 시 집앞에 놔주세요.">부재 시 집앞에 놔주세요.</option>
                    <option value="직접입력">직접입력</option>
                </select><br>
                <textarea name="request" id="request_content" style="resize:none; width:300px; height:100px;"></textarea>
            </td>
        </tr>
        <tr>
            <td colspan="2" style="text-align:right;">
                <br>
                <input type="submit" value="결제하기">
            </td>
        </tr>
    </table>
    </form>
    <br><br>
</section>

<th:block th:replace="~{../static/inc/bottom.html}"></th:block>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    window.onload = function()
    {
        var price = document.getElementsByClassName("price");
        var result = 0;
        for(var a=0; a<price.length; a++)
        {
            result += parseInt(price[a].innerHTML);
        }
        document.getElementById("total").innerHTML = result;
        document.getElementById("pay_price").innerHTML = result;
        document.getElementById("total_pay").value = result;

        var pay_cash = parseInt(document.getElementById("pay_cash").innerHTML);
        var pay_price = parseInt(document.getElementById("pay_price").innerHTML);
        if(pay_cash >= pay_price) // 잔액 < 구매금액
        {
            document.getElementById("pay_result").innerHTML = pay_cash - pay_price;
        }
        else
        {
            alert("잔액이 부족합니다!");
            location.replace('/User/Basket');
        }
    }
    function request_set(value)
    {
        if(value == "직접입력")
        {
            document.getElementById("request_content").innerHTML = "";
        }
        else if(value == "none")
        {
            document.getElementById("request_content").innerHTML = "";
        }
        else
        {
            document.getElementById("request_content").innerHTML = value;
        }
    }

    function address_api()
    {
        new daum.Postcode({
            oncomplete: function(data)
            {
                var addr = ''; // 주소 변수
                var extraAddr = ''; // 참고항목 변수

                if (data.userSelectedType === 'R') // 사용자가 도로명 주소를 선택했을 경우
                {
                    addr = data.roadAddress;
                }
                else // 사용자가 지번 주소를 선택했을 경우(J)
                {
                    addr = data.jibunAddress;
                }

                // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
                if(data.userSelectedType === 'R')
                {
                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname))
                    {
                        extraAddr += data.bname;
                    }
                    if(data.buildingName !== '' && data.apartment === 'Y')
                    {
                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    if(extraAddr !== '')
                    {
                        extraAddr = ' (' + extraAddr + ')';
                    }
                    document.getElementById("add3").value = extraAddr;
                }
                else
                {
                    document.getElementById("add3").value = '';
                }
                document.getElementById('add1').value = data.zonecode;
                document.getElementById("add2").value = addr;
            }
        }).open();
    }
    function payment_way(value)
    {
        if(value == "account")
        {
            document.getElementById("account_div").style.display = "inline";
            document.getElementById("card_div").style.display = "none";
            document.getElementById("drink_pay_div").style.display = "none";
        }
        else if(value == "card")
        {
            document.getElementById("account_div").style.display = "none";
            document.getElementById("card_div").style.display = "inline";
            document.getElementById("drink_pay_div").style.display = "none";
        }
        else if(value == "drink_pay")
        {
            document.getElementById("account_div").style.display = "none";
            document.getElementById("card_div").style.display = "none";
            document.getElementById("drink_pay_div").style.display = "inline";
        }
    }
    function random_account(value)
    {
        if(value == "none")
        {
            document.getElementById("auto_account").value = "";
        }
        else if(value == "NH_BANK")
        {
            document.getElementById("auto_account").value = "001-1234-1234-1";
        }
        else if(value == "DGB_BANK")
        {
            document.getElementById("auto_account").value = "002-1234-1234-2";
        }
        else if(value == "IBK_BANK")
        {
            document.getElementById("auto_account").value = "003-1234-1234-3";
        }
        else if(value == "SHINHAN_BANK")
        {
            document.getElementById("auto_account").value = "004-1234-1234-4";
        }
    }
</script>
</html>

